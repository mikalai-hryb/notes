# AWS S3 - Simple Storage Service

## What is S3 service?

AWS S3 is a regional service, but it has global features such as global namespace, global access and so on.

* max object size is 5TB
* if uploading a file more than 5GB, must us "multi-part upload"

## What is S3 Glacier?

It's like the archival service of AWS S3.
There are a few S3 Glacier Storage Classes.

## What are use cases of S3?

* Backup and storage
* Disaster Recovery (store configuration files to quickly rebuild infrastructure)
* Archive (we can retrieve data after archiving at a later stage for much cheaper)
* Hybrid Cloud storage (expand on-prem storage into the cloud)
* Application hosting
* Media hosting (videos and images)
* Data lakes & big data analytics
* Software delivery
* Static website hosting (CloudFront can be used or just putting files into a bucket)

## What are bucket naming convention?

* no uppercase, no underscore
* 3-63 characters long
* not an IP
* must start with lowercase letter or number
* must NOT start with the prefix `xn--`
* must NOT end with the suffix  `-s3alias`

## What is Bucket?

Bucket can be seen as a top-level directory.

Buckets must have a globally unique name (across all regions all account).
Buckets are defined at the region level.

## What is Bucket Object?

Files in buckets are called Objects.

Objects have a Key.

## What is Object Key?

Key is the FULL path of you file.

The key is composed of `prefix + object name`.

For example, we have `s3://my-bucket/my_file.txt`.
The key of `my_file.txt` file is `my_file.txt`.
The key prefix is `/` and object name is `my_file.txt`.

For example, we have `s3://my-bucket/my_folder/another_folder/my_file.txt`.
The key of `my_file.txt` file is `my_folder/another_folder/my_file.txt`.
The key prefix is `my_folder/another_folder/` and object name is `my_file.txt`.

S3 has no concept of "directories" within buckets.
Anything and everything in S3 is actually a key.
Keys are just very long names that contain slashes and keys are made of `prefix` and `object name`.

## What is Object Value?

Object values are the content of the body.

## What is Object Metadata?

Object Metadata is list of text key/value pairs

## What is Object Tags?

Object Tags is unicode key/value pair - up to 10.
They are useful for security/lifecycle.

## What is Object Version ID?

Unique version ID value for the object, if bucket versioning is enabled.

## What is S3 pre-signed URL?

An S3 pre-signed URL is a secure, time-limited link that allows temporary access to a specific object in an S3 bucket, even if the bucket or object is private. It is commonly used to grant access to an S3 object without exposing your AWS credentials or changing the bucket's permissions.

## How can we limit bucket access?

* user-based policies
  * IAM Policies
* resource-based policies
  * Bucket Policies - bucket wide rules
  * Object Access Control List (ACL) - finer grain (can be disabled)
  * Bucket Access Control List (ACL) - less common (can be disabled)

## What do we use the S3 Bucket Policy to?

* Grant public access to the bucket
* Force objects to be encrypted at upload
* Grant access to another account (Cross Account)

## When IAM principal can access an S3 object?

* if the user IAM permissions ALLOW it OR the resource policy ALLOWS it AND there is no explicit DENY

## What is Block Public Access settings?

These settings were invented by AWS as an extra layer of security to prevent company data leaks.

Even though you would set an S3 Bucket policy that would make it public, if Block Public Access settings are enabled, the bucket will never be public.

## What steps should be done to start hosting static website on S3 Bucket?

* disable `Block Public Access` setting
* attach `Bucket policy` which allows reading files from the bucket
* enable `Static website hosting`
* specify `index document`
* upload `index document` to the bucket

The site will be accusable on

http://`<bucket-name>`.s3-website-`<aws-region>`.amazonaws.com
OR
http://`<bucket-name>`.s3-website.`<aws-region>`.amazonaws.com

## What is S3 Versioning?

Versioning in Amazon S3 is a means of keeping multiple variants of an object in the same bucket. It protects against unintended deletes (ability to restore a version).

It's enabled at the bucket level.

Suspending versioning does not delete the previous versions.

When you delete a file with Versioning enabled, the file will not be deleted, AWS creates a delete marker. It's a placeholder for a versioned object. the delete marker makes Amazon S3 behave as if the object is deleted.

## What is Delete Marker?

When you delete a file with Versioning enabled, the file will not be deleted, AWS creates a delete marker (object). It's a placeholder (or marker) for a versioned object that was specified in a simple DELETE request. The delete marker makes Amazon S3 behave as if the object is deleted.

When you delete a specific version of a file, this operation is permanent (AWS does not add delete marker object).

## What is S3 Replication?

S3 Replication allows you to replicate data between S3 buckets within and across AWS Regions.

There are 2 types of replication

* Cross-Region Replication (CRR)
  * compliance
  * lower latency
  * replication across accounts
* Same-Region Replication (SRR)
  * log aggregation across multiple S3 Buckets
  * live replication between production and test accounts

Some notes about Replication

* We must enable Version in source and destination buckets
* Buckets can be in different AWS Accounts
* Coping is asynchronous
* Must give proper IAM permissions to S3
* after you enable Replication, only new objects are replicated
* use S3 Batch Replication feature for existing objects
* there is no "chaining" of replication (Bucket One to Bucket Two but not to Bucket Three)
* only delete markers are replicated but not deletes (when you delete a specific version of a file)

## What are Storage Classes?

Storage Classes are cost-effective storage options for different use cases by balancing cost, durability, and availability.

For all classes the Durability is the same 99,999999999% or 11 9's.
The availability is different.
For "Glacier" classes there is cost for object retrial.
For "Glacier" classes there is minimum storage duration, it means you will be charged for minimum storage duration period.

* Amazon S3 Standard - General Purpose (availability 99,99%)
* Amazon S3 Standard-Infrequent Access (availability 99,9%)
* Amazon S3 One Zone-Infrequent Access (availability 99,5%, data lost when AZ is destroyed)

* Amazon S3 Glacier Instant Retrieval (millisecond retrieval)
* Amazon S3 Glacier Flexible Retrieval (from 1 min to 12 hours retrieval)
* Amazon S3 Glacier Deep Archive (from 12 hours to 48 hours retrieval)

* Amazon S3 Intelligent Tiering
